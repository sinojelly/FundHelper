	<p>
	<button id="save">Save</button>
	<div id="fund-table"></div> 
	<div id="updateModelStatus"></div>
	</p>
	<script>
	var tabledata = [
 	["005911", "广发双擎升级混合", "5", "2.0368", "0.17", "-15.21", "20191021", "-1.02", "20191120"],
	["320007", "诺安成长混合", "5", "1.195", "0.5", "-16.15", "20191021", "-3.77", "20191119"],
    ];
	var container = document.getElementById('fund-table');
	var hot = new Handsontable(container, {
	  data: null, //tabledata,
	  rowHeaders: false,
	  colHeaders: ["Fund ID", "Name", "Level", "Price", "Change", "R2Low", "LowDate", "R2High", "HighDate"],
	  filters: true,
	  dropdownMenu: true,
      autoColumnSize: true,
	  contextMenu: true,
	  licenseKey: 'non-commercial-and-evaluation'
	});	
	
	$( document ).ready(function() {
		console.log( "ready!" );
		$.ajax({
			url: 'load-fund-data/' + {{thread_id}},
			type: 'GET',
			contentType: 'application/json; charset=utf-8',    
			dataType: 'json',
			async: true,
			success: function(msg) {
				hot.loadData(msg.data);
				console.log('Loaded:');
				console.log(msg.data);
			}
		});
	});
	
	function save_data() {
	  var temp = hot.getData();
	  // save all cell's data
	  $.ajax('save-data/' + {{thread_id}}, 'GET', JSON.stringify({data: hot.getData()}), function (res) {
		var response = JSON.parse(res.response);

		if (response.result === 'ok') {
		  $("#updateModelStatus").text("Update model: Save success");
		}
		else {
		  $("#updateModelStatus").text("Update model: Save error");
		}
	  });
    }
	$("#save").click(save_data);
	
	
	function append_parameter(url, name, value) {
	    if (!url.endsWith('?')) {
		    url = url + "&";
		}
	    return url + name + "=" + encodeURIComponent(value);
	}
	function update_model_old() {
		$("#updateModelStatus").text("Update model: Start...");
		var fund_id = $("#fund_id[name='fund_id']").val();
		var fund_level = $("#fund_level[name='fund_level']").val();
		var fund_high_date = $("#fund_high_date[name='fund_high_date']").val();
		var fund_low_date = $("#fund_low_date[name='fund_low_date']").val();
		var remove_fund_id = $("#remove_fund_id[name='remove_fund_id']").val();
		
		var url = 'update-model?';
		url = append_parameter(url, "fund_id", fund_id);
		url = append_parameter(url, "fund_level", fund_level);
		url = append_parameter(url, "fund_high_date", fund_high_date);
		url = append_parameter(url, "fund_low_date", fund_low_date);
		url = append_parameter(url, "remove_fund_id", remove_fund_id);
		
		$.get(url, function(data) {
			$("#updateModelStatus").text("Update model: " + data.msg);
		})
	}
	$(".updateModel").click(update_model_old);
	</script>
